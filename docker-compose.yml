services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: feedprism-qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    environment:
      - QDRANT__SERVICE__API_KEY=${QDRANT_API_KEY}
    volumes:
      - qdrant_data:/qdrant/storage
    restart: unless-stopped

  backend:
    build:
      context: ./feedprism_main
      dockerfile: Dockerfile
    container_name: feedprism-backend
    ports:
      - "8000:8000"
    environment:
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - QDRANT_API_KEY=${QDRANT_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - DEMO_MODE=${DEMO_MODE:-true}
      - DEMO_USER_NAME=${DEMO_USER_NAME:-Demo User}
      - DEMO_USER_EMAIL=${DEMO_USER_EMAIL:-demo@feedprism.app}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
    volumes:
      - ./feedprism_main/data:/app/data
    depends_on:
      - qdrant
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: feedprism-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped

  lamatic-bridge:
    build:
      context: ./lamatic_bridge
      dockerfile: Dockerfile
    container_name: feedprism-lamatic-bridge
    ports:
      - "8001:8001"
    environment:
      - FEEDPRISM_URL=http://backend:8000
      - QDRANT_HOST=qdrant
      - QDRANT_PORT=6333
      - QDRANT_API_KEY=${QDRANT_API_KEY}
      - BRIDGE_PORT=8001
    depends_on:
      - backend
      - qdrant
    restart: unless-stopped

volumes:
  qdrant_data:
